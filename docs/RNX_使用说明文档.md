
# 🛰️ RNX量子天线测试系统 使用说明

## 🧩 软件简介
该软件为**RNX量子天线测试系统Demo版**，用于天线链路配置、信号源控制及运动模组管理。支持频率联动控制、功率补偿、链路图直观显示与校准数据加载。

---

## 📋 目录
- [界面总览](#界面总览)
- [主要功能模块说明](#主要功能模块说明)
  - [1. 链路图](#1-链路图)
  - [2. 状态显示](#2-状态显示)
  - [3. 网络设置](#3-网络设置)
  - [4. 链路控制](#4-链路控制)
  - [5. 信号源控制](#5-信号源控制)
  - [6. 运动控制](#6-运动控制)
  - [7. 日志区](#7-日志区)
  - [8. 校准功能](#8-校准功能)
- [进阶功能](#进阶功能)
  - [校准文件加载](#校准文件加载)
  - [合并校准文件](#校准文件合并与导入)
  - [频率联动机制](#频率联动机制)
- [注意事项](#注意事项)

---

## 🖥️ 界面总览
软件界面分为**左侧链路图与日志面板**，以及**右侧控制与状态模块**：

- **左侧**：
  - 上：链路拓扑图（显示当前连接的馈源端口）
  - 下：日志输出（系统运行信息与命令执行日志）

- **右侧**：
  - 状态信息展示（运动模组/信号源）
  - 网络设置
  - 链路控制
  - 信号源参数设置
  - 运动控制按钮组

---

## 🔧 主要功能模块说明

### 1. 链路图
- 图形展示当前**信号源连接的端口与馈源**。
- 动态变化，例如：`X_THETA`高亮表示当前激活链路。

---

### 2. 状态显示
- **运动模组状态**：各轴(X, KU, K, KA, Z)的达位/复位/速度状态。
- **信号源状态**：频率、功率、RF输出、校准状态显示（`Calib Miss` 表示未加载校准文件）。

---

### 3. 网络设置
| 控件         | 功能                         |
|--------------|------------------------------|
| ETH IP / Port | 设置设备的网络地址和端口      |
| 连接 / 断开连接 | 建立或断开与控制设备的TCP连接 |
| 频率联动     | 勾选后，频率变化将自动控制链路和运动轴 |

---

### 4. 链路控制
| 控件         | 功能                     |
|--------------|--------------------------|
| 链路模式选择 | 手动选择链路路径 (如 `FEED_KA_PHI`) |
| 设置链路     | 向设备发送链路切换命令     |
| 查询链路     | 查询当前链路状态并刷新图形 |

---

### 5. 信号源控制
| 功能项     | 描述                                       |
|------------|--------------------------------------------|
| 信号频率设置 | 支持单位 GHz / MHz / kHz，点击“设置频率”生效 |
| 馈源功率设置 | 输入实际补偿后的功率值，支持多种单位如 dBm、V/m |
| 原始功率    | 显示信号源应输出的原始功率（自动计算）          |
| RF输出开关  | 控制射频输出开或关                             |

---

### 6. 运动控制
| 控件     | 描述                            |
|----------|---------------------------------|
| 系统初始化 | 一键执行设备复位、信号源关闭、清状态等操作 |
| 执行复位  | 选中轴(X/KU/K/KA/ALL)，执行复位动作        |
| 执行达位  | 移动选中轴到预设角度（默认θ位置）          |
| 设置速度  | 设置指定轴的运动速度(LOW~HIGH五档)        |

---

### 7. 日志区
- 实时输出系统状态信息、命令发送/接收、校准信息等。
- 支持按等级过滤（INFO、ERROR等）与搜索。

---

## 8. 校准功能
 
通过顶部工具栏的"🛠 校准"按钮打开独立校准窗口，主要功能包括：
 
### 8.1 设备连接
 
| 控件               | 功能说明                                                                 |
|--------------------|--------------------------------------------------------------------------|
| 信号源型号         | 输入信号源型号（如PLASG）                                                |
| 信号源地址         | 输入信号源的VISA地址（如`TCPIP0::192.168.1.10::inst0::INSTR`）           |
| 功率计型号         | 输入功率计型号（如NRP50S）                                               |
| 功率计地址         | 输入功率计的VISA地址                                                     |
| 自动检测           | 自动扫描并识别连接的VISA仪器                                             |
| 连接仪器           | 建立与仪器的通信连接                                                     |
 
### 8.2 天线参数设置
 
| 控件               | 功能说明                                                                 |
|--------------------|--------------------------------------------------------------------------|
| 天线型号           | 输入待测天线型号（如RNX_ANT）                                            |
| 天线序列号         | 输入天线序列号                                                           |
| 导入增益           | 导入标准增益天线的增益曲线CSV文件（需包含freq和gain列）                  |
 
### 8.3 校准模式选择
 
| 模式               | 描述                                                                     |
|--------------------|--------------------------------------------------------------------------|
| 频率范围模式       | 设置起始/终止频率和步进值进行线性扫描（默认8-40GHz，步进0.01GHz）        |
| 频点列表模式       | 导入自定义频率列表CSV文件（需包含freq列）                                |
 
### 8.4 基础参数设置
 
| 参数               | 说明                                                                     |
|--------------------|--------------------------------------------------------------------------|
| 参考功率(dBm)      | 设置信号源输出参考功率（默认-30dBm）                                     |
| 极化选择           | 选择THETA/PHI极化或双极化测量                                            |
 
### 8.5 校准控制
 
| 按钮               | 功能                                                                     |
|--------------------|--------------------------------------------------------------------------|
| 开始校准           | 启动校准流程（需先连接仪器）                                             |
| 终止               | 中断正在进行的校准                                                       |
| 导出数据           | 将校准结果导出为CSV文件                                                  |
 
### 8.6 校准流程指示
- **进度条**：实时显示校准进度
- **状态提示**：显示当前操作步骤（如"正在测量8.0GHz..."）
- **完成提示**：校准完成后弹出提示框显示总频点数
 
## 天线增益文件要求
 
天线增益CSV文件包含以下列：
```csv
freq,gain
8.0,15.2
12.0,16.1
```


## ⚙️ 进阶功能
 
### 校准文件合并与导入
软件支持将多个校准文件合并为一个综合校准文件，便于管理不同频段的校准数据：
 
1. **合并功能入口**：
   - 点击顶部工具栏的"导入"按钮（📥图标）
 
2. **操作步骤**：
   - 在弹出的文件选择对话框中，按住`Ctrl`键选择多个校准文件（支持`.csv`和`.bin`格式）
   - 至少选择2个文件才能进行合并
   - 系统会自动识别文件中的频率范围并进行智能合并
 
3. **合并规则**：
   - 频率范围自动衔接，重叠部分取平均值
   - 元数据（如设备信息、操作员等）从第一个文件继承
   - 参考功率(ref_power)会读取个文件进行综合
 
4. **合并后操作**：
   - 成功合并后会提示保存路径
   - 可选择立即导入合并后的文件
   - 合并日志会记录原始文件信息和处理过程
 
5. **典型应用场景**：
   - 合并X波段(8-12GHz)和KU波段(12-18GHz)的校准数据
   - 整合不同极化方向(THETA/PHI)的测量结果
   - 将分段测量的数据合并为完整频段数据
 
### 校准文件加载
- 点击右上角工具栏的"🛠 校准"按钮，弹出校准面板
- 加载支持 `.csv` 或 `.bin` 校准文件
- 成功后状态标识变为：`Calib Load`，同时启用功率补偿
 
### 频率联动机制
- 勾选"频率联动"复选框后：
  - 当设置频率时，会自动选择匹配频段的链路（X/KU/K/KA）
  - 系统将根据频率范围自动切换馈源轴
 
| 频率范围(GHz) | 自动链路                 |
|----------------|--------------------------|
| 8 ~ 12         | FEED_X_THETA / PHI       |
| 12 ~ 18        | FEED_KU_THETA / PHI      |
| 18 ~ 26.5      | FEED_K_THETA / PHI       |
| 26.5 ~ 40      | FEED_KA_THETA / PHI      |
 
## ❗ 合并校准文件注意事项
1. 确保待合并文件的频率范围连续或部分重叠,否则不重叠部分的插值计算有较大误差
2. 建议合并前备份原始校准文件
3. 合并后的文件会保存在`calibrations/archive`目录下
4. 若合并失败，请检查：
   - 文件是否损坏
   - 频率范围是否冲突
   - 文件格式是否一致
5. 大文件合并可能需要较长时间，请耐心等待

## ❗ 注意事项
- 请确保TCP连接成功后再执行初始化或链路/信号源控制操作。
- 若未加载校准文件，所有补偿相关操作将视为无效。
- 输入功率值时建议单位与频率匹配（如电场强度单位需已知频率）。
- 关闭软件前建议先断开连接，防止线程或TCP未释放。
## ❗ 进行校准时请确保：
- 仪器已正确连接并预热
- 测试环境无强电磁干扰
- 天线固定稳固且极化方向正确
- 导入的增益文件频率范围应覆盖校准频段
- 校准时请勿移动设备或更改连接线缆
- 建议在环境温度25±5℃下进行校准
---
